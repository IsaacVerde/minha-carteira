

<!DOCTYPE html>
<html lang="pt-br">

<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1">
Â  Â  
Â  Â  <% if (typeof user !== 'undefined' && user) { %>
Â  Â  Â  Â  <title>Dashboard | Controle Financeiro</title>
Â  Â  <% } else { %>
Â  Â  Â  Â  <title>Login | Controle Financeiro</title>
Â  Â  <% } %>

Â  Â  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
Â  Â  Â  Â  integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

Â  Â  <link rel="stylesheet" href="/css/styles.css">
Â  Â  

Â  Â  </head>

<body class="bg-light">

Â  Â  <% if (typeof user !== 'undefined' && user) { %>

Â  Â  Â  Â  <div class="container mt-4">

Â  Â  Â  Â  Â  Â  <div class="header">
Â  Â  Â  Â  Â  Â  Â  Â  <h1>Bem-vindo, <%= user.email %></h1>
Â  Â  Â  Â  Â  Â  Â  Â  <form action="/logout" method="POST"><button type="submit" class="btn btn-danger btn-lg">Sair</button></form>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="card shadow-sm mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form action="/dashboard" method="GET" class="d-flex flex-wrap gap-2 align-items-center mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-secondary fw-bold me-3 mb-0 d-none d-md-block">TransaÃ§Ãµes de <%= periodTitle %></h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="month_year_filter" class="form-label fw-bold mb-0">Visualizar MÃªs:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="month" id="month_year_filter" name="month_year_filter" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â value="<%= currentMonthYear %>" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="form-control" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â style="width: 180px;">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary">Filtrar MÃªs</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <hr>

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex flex-wrap gap-2 align-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label class="form-label fw-bold mb-0">Visualizar PerÃ­odo:</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/dashboard?period=7" class="btn btn-outline-secondary">Ãšltimos 7 dias</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/dashboard?period=30" class="btn btn-outline-secondary">Ãšltimos 30 dias</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/dashboard?period=365" class="btn btn-outline-secondary">Ãšltimos 12 meses</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/dashboard" class="btn btn-link ms-auto">Ver MÃªs Atual</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <h2 class="mt-5">Resumo do PerÃ­odo</h2>
Â  Â  Â  Â  Â  Â  <div class="row g-3 mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-secondary">Total Receitas</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="valor-receita">R$ <%= resumo.totalReceitas %></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-secondary">Total Despesas</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="valor-despesa">R$ <%= resumo.totalDespesas %></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title text-secondary">Saldo</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="valor-saldo <%= (parseFloat(resumo.saldo) >= 0 ? 'color-blue' : 'color-red') %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  R$ <%= resumo.saldo %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <h2 class="mt-5">+ Nova TransaÃ§Ã£o</h2>
Â  Â  Â  Â  Â  Â  <div class="card shadow-sm mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body p-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form action="/transactions" method="POST" class="row g-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="month_year_filter" value="<%= currentMonthYear %>">

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% if (locals.message) { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-12">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="alert <%= (locals.message.includes('sucesso') ? 'alert-success' : 'alert-danger') %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <%= message %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="name" class="form-label">Nome da TransaÃ§Ã£o</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="text" class="form-control" id="name" name="name" placeholder="Ex: Compra no mercado" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="value" class="form-label">Valor (R$)</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="number" class="form-control" id="value" name="value" step="0.01" min="0.01" placeholder="0.00" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="transaction_date" class="form-label">Data</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="date" class="form-control" id="transaction_date" name="transaction_date" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="type" class="form-label">Tipo</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="type" name="type" class="form-select" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Despesa" selected>Despesa</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Receita">Receita</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="category" class="form-label">Categoria</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="category" name="category" class="form-select" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Moradia">Moradia</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="AlimentaÃ§Ã£o">AlimentaÃ§Ã£o</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Transporte">Transporte</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Lazer">Lazer</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SaÃºde">SaÃºde</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="SalÃ¡rio">SalÃ¡rio</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Outros" selected>Outros</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="payment_method" class="form-label">MÃ©todo de Pagamento</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="payment_method" name="payment_method" class="form-select" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="CartÃ£o de CrÃ©dito">CartÃ£o de CrÃ©dito</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="DÃ©bito">DÃ©bito</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Dinheiro">Dinheiro</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="PIX">PIX</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Boleto">Boleto</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="status" class="form-label">Status</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <select id="status" name="status" class="form-select" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="Pago" selected>Pago</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <option value="A Pagar">A Pagar / Pendente</option>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </select>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-12 mt-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary btn-lg w-100">Adicionar TransaÃ§Ã£o</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <div class="row g-3 mb-4 mt-5">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-lg-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="h4">Gasto Total por Categoria</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-responsive"> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="table align-middle">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Categoria</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Receitas (R$)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Despesas (R$)</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% if (locals.fluxoDeCaixaPorCategoria && locals.fluxoDeCaixaPorCategoria.length > 0) { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% fluxoDeCaixaPorCategoria.forEach(item => { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const receita = parseFloat(item.receita_total);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const despesa = parseFloat(item.despesa_total);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= item.categoria %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="color-blue">R$ <%= receita.toFixed(2) %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="color-red">R$ <%= despesa.toFixed(2) %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% }); %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } else { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="3" class="text-center text-muted p-4">Nenhuma transaÃ§Ã£o categorizada.</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-lg-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="h4">GrÃ¡fico de Fluxo de Caixa</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm h-100">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% if (locals.fluxoDeCaixaPorCategoria && locals.fluxoDeCaixaPorCategoria.length > 0) { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div id="google_chart_div" style="width: 100%; height: 350px;"></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } else { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-muted p-4">Adicione receitas e despesas para visualizar o fluxo de caixa.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  <h2 class="text-center mt-5 mb-3">â˜° Todas as TransaÃ§Ãµes</h2>
Â  Â  Â  Â  Â  Â  <div class="card shadow-sm mb-5">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="table-responsive">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <table class="table align-middle table-hover">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <th>Nome</th><th>Tipo</th><th>Categoria</th><th>Valor (R$)</th><th>Data</th><th>Pagamento</th><th>Status</th><th>AÃ§Ãµes</th>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </thead>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% if (locals.todasTransacoes && locals.todasTransacoes.length > 0) { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% todasTransacoes.forEach(transacao => { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr class="<%= (transacao.tipo === 'Receita' ? 'row-receita' : 'row-despesa') %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.nome %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.tipo %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.categoria %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td class="<%= (transacao.tipo === 'Receita' ? 'color-blue' : 'color-red') %> fw-bold">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  R$ <%= parseFloat(transacao.valor).toFixed(2) %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.data_formatada %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.metodo_pagamento %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td><%= transacao.status %></td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form action="/transactions/delete" method="POST" style="display: inline;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="id" value="<%= transacao.id %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="hidden" name="month_year_filter" value="<%= currentMonthYear %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-danger btn-sm">Deletar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="/transactions/edit/<%= transacao.id %>?filter=<%= currentMonthYear %>">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="button" class="btn btn-primary btn-sm">Editar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% }); %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } else { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <td colspan="8" class="text-center text-muted p-4">Nenhuma transaÃ§Ã£o registrada neste perÃ­odo.</td>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tr>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <% } %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </tbody>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </table>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  </div> 

Â  Â  <% } else { %>

Â  Â  Â  Â  <div class="container vh-100 d-flex align-items-center justify-content-center">
Â  Â  Â  Â  Â  Â  <div class="row w-100" style="max-width: 900px;"> <% if (locals.message) { %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-12 mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="alert <%= (locals.message.includes('sucesso') ? 'alert-success' : 'alert-danger') %> text-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <%= message %>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <% } %>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-lg-6 mb-4 mb-lg-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body p-4 p-md-5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-center mb-4">Login</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form action="/login" method="POST">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="login_email" class="form-label">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" class="form-control" id="login_email" name="email" placeholder="seu@email.com" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="login_password" class="form-label">Senha</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" class="form-control" id="login_password" name="password" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-primary btn-lg w-100 mt-3">Entrar</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-lg-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card shadow-sm">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body p-4 p-md-5">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-center mb-4">Registrar-se</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-center text-muted mb-4">Novo por aqui? Crie sua conta.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <form action="/register" method="POST">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="reg_email" class="form-label">Email</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="email" class="form-control" id="reg_email" name="email" placeholder="seu@email.com" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="mb-3">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <label for="reg_password" class="form-label">Senha</label>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input type="password" class="form-control" id="reg_password" name="password" required>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button type="submit" class="btn btn-outline-primary btn-lg w-100 mt-3">Criar Conta</button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </form>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </div>

Â  Â  <% } %>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
Â  Â  
Â  Â  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
Â  Â  
Â  Â  <% if (typeof user !== 'undefined' && user) { %>
Â  Â  Â  Â  <script type="text/javascript">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  // Verifica se hÃ¡ dados antes de tentar carregar o grÃ¡fico
Â  Â  Â  Â  Â  Â  <% if (locals.fluxoDeCaixaPorCategoria && locals.fluxoDeCaixaPorCategoria.length > 0) { %>
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  google.charts.load('current', {'packages':['corechart']});
Â  Â  Â  Â  Â  Â  Â  Â  google.charts.setOnLoadCallback(drawChart);

Â  Â  Â  Â  Â  Â  Â  Â  function drawChart() {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const fluxoData = <%- JSON.stringify(fluxoDeCaixaPorCategoria || []) %>;

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const dataArray = [['Categoria', 'Receitas', 'Despesas']];
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  fluxoData.forEach(item => {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dataArray.push([
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  item.categoria,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parseFloat(item.receita_total),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  parseFloat(item.despesa_total)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ]);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  });

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const data = google.visualization.arrayToDataTable(dataArray);

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ================================================================
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ðŸ›‘ MUDANÃ‡A PRINCIPAL AQUI: OpÃ§Ãµes do GrÃ¡fico
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ================================================================
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const options = {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  legend: { position: 'top', textStyle: { color: '#495057' } },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  colors: ['#007bff', '#dc3545'], // Azul (Receita), Vermelho (Despesa)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  backgroundColor: 'transparent',

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ðŸ›‘ MUDANÃ‡A: Usando PIXELS fixos para as margens.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Isso Ã© mais estÃ¡vel que porcentagens.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chartArea: { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  left: 50, Â  Â // <-- Deixa 50px para o "Valor (R$)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  top: 40, Â  Â  // <-- Deixa 40px para a Legenda
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  right: 20, Â  // <-- Deixa 20px de "ar" na direita
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bottom: 50 Â  // <-- Deixa 50px para a "Categoria"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  vAxis: { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Valor (R$)', 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  minValue: 0, 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  gridlines: { color: '#eee' },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textStyle: { color: '#6c757d' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  hAxis: { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title: 'Categoria',
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  textStyle: { color: '#6c757d' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  },
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  bar: { groupWidth: '80%' }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ================================================================
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // FIM DA MUDANÃ‡A
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // ================================================================

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chartElement = document.getElementById('google_chart_div');
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (chartElement) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const chart = new google.visualization.ColumnChart(chartElement);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  chart.draw(data, options);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  <% } %>
Â  Â  Â  Â  </script>
Â  Â  <% } %>

</body>
</html>